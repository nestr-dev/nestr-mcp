<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nestr MCP Server - Connect AI to Your Workspace</title>
  <meta name="description" content="Connect Claude, Cursor, and other AI assistants to your Nestr workspace using the Model Context Protocol (MCP).">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="https://app.nestr.io/favicon.ico">
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <img src="logo.png" alt="Nestr" width="32" height="32">
        <span>Nestr MCP</span>
      </div>
      <nav>
        <a href="https://app.nestr.io" target="_blank">Open Nestr</a>
        <a href="https://help.nestr.io" target="_blank">Help</a>
        <a href="https://github.com/nestr-dev/nestr-mcp" target="_blank">GitHub</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <h1>Connect AI to Your Nestr Workspace</h1>
        <p class="subtitle">
          Use the Model Context Protocol (MCP) to let Claude, Cursor, and other AI assistants
          interact with your tasks, projects, circles, and roles.
        </p>
        <div class="cta-buttons">
          <a href="#setup" class="btn primary">Get Started</a>
          <a href="#examples" class="btn secondary">See Examples</a>
        </div>
      </div>
    </section>

    <section class="features">
      <div class="container">
        <div class="feature-grid">
          <div class="feature">
            <div class="feature-icon">&#128269;</div>
            <h3>Search & Navigate</h3>
            <p>Find tasks, projects, and roles using natural language queries across your workspace.</p>
          </div>
          <div class="feature">
            <div class="feature-icon">&#10003;</div>
            <h3>Manage Tasks</h3>
            <p>Create, update, and organize nests without leaving your AI assistant.</p>
          </div>
          <div class="feature">
            <div class="feature-icon">&#128101;</div>
            <h3>Understand Structure</h3>
            <p>Explore circles, roles, and accountabilities to know who's responsible for what.</p>
          </div>
          <div class="feature">
            <div class="feature-icon">&#128200;</div>
            <h3>Track Metrics</h3>
            <p>Get insights on workspace activity, completion rates, and team performance.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="setup" class="setup">
      <div class="container">
        <h2>Setup Guide</h2>

        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h3>Choose Your Authentication Method</h3>

            <div class="auth-options">
              <button class="auth-option active" data-auth="oauth">
                <div class="option-header">
                  <h4>OAuth</h4>
                  <span class="option-badge">Recommended</span>
                </div>
                <p>Respects your user-specific permissions. You'll only access nests you have permission to.</p>
                <ul class="option-pros">
                  <li>Per-user permissions</li>
                  <li>Secure token-based auth</li>
                  <li>MCP clients auto-discover endpoints</li>
                </ul>
              </button>

              <button class="auth-option" data-auth="apikey">
                <div class="option-header">
                  <h4>API Key</h4>
                </div>
                <p>Full workspace access, useful for automation or when OAuth isn't supported.</p>
                <ul class="option-pros">
                  <li>Simple to set up</li>
                  <li>Works everywhere</li>
                  <li>Good for automation</li>
                </ul>
              </button>
            </div>

            <div class="auth-details">
              <div class="auth-detail active" id="auth-detail-oauth"></div>

              <div class="auth-detail" id="auth-detail-apikey">
                <p>To get an API key:</p>
                <ol>
                  <li>Go to your <a href="https://app.nestr.io" target="_blank">Nestr workspace</a></li>
                  <li>Click the <strong>Settings</strong> icon (gear) in the top right</li>
                  <li>Navigate to the <strong>Integrations</strong> tab</li>
                  <li>Find <strong>"Workspace API access"</strong> and click <strong>Configure</strong></li>
                  <li>Click <strong>"New API key"</strong> and copy the generated key</li>
                </ol>
                <div class="warning">
                  <strong>Note:</strong> API keys have full workspace access regardless of user permissions.
                  Store securely and never commit to version control.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h3>Choose Your Setup Method</h3>

            <div class="setup-options">
              <button class="setup-option active" data-method="hosted">
                <div class="option-header">
                  <h4>Cloud</h4>
                </div>
                <p>Connect directly to Nestr's MCP server. No installation required. Just add your API key.</p>
                <ul class="option-pros">
                  <li>Zero setup, works immediately</li>
                  <li>Always up to date</li>
                  <li>No Node.js required</li>
                </ul>
              </button>

              <button class="setup-option" data-method="local">
                <div class="option-header">
                  <h4>Local</h4>
                </div>
                <p>Run the MCP server on your machine via npm. Best for developers or offline use.</p>
                <ul class="option-pros">
                  <li>Works offline</li>
                  <li>Full control over the server</li>
                  <li>Can pin to specific versions</li>
                </ul>
              </button>
            </div>

          </div>
        </div>

        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h3>Configure Your AI Client</h3>

            <div class="tabs">
              <button class="tab active" data-tab="claude-desktop">Claude Desktop</button>
              <button class="tab" data-tab="claude-code">Claude Code</button>
              <button class="tab" data-tab="cursor">Cursor</button>
              <button class="tab" data-tab="manual">Other / Manual</button>
            </div>

            <div class="tab-content active" id="claude-desktop">
              <div class="config-block hosted oauth active">
                <div class="quickstart-box">
                  <h4>Quickstart (Recommended)</h4>
                  <p><strong>Step 1:</strong> In Claude Desktop, go to <strong>Settings &rarr; Connectors &rarr; Add custom connector</strong></p>
                  <p><strong>Step 2:</strong> Fill in the following:</p>
                  <table class="field-table">
                    <tr><td><strong>Name</strong></td><td><code>Nestr</code></td></tr>
                    <tr><td><strong>Remote MCP URL</strong></td><td><code>https://mcp.nestr.io/mcp</code></td></tr>
                  </table>
                  <p><strong>Step 3:</strong> Click "Add" and then "Authenticate" to log in with your Nestr account.</p>
                  <p class="quickstart-note">That's it! Claude Desktop will handle the OAuth flow automatically.</p>
                </div>
              </div>

              <div class="config-block hosted apikey">
                <p>Go to <strong>Settings &rarr; Connectors &rarr; Add custom connector</strong> and fill in:</p>
                <table class="field-table">
                  <tr><td><strong>Name</strong></td><td><code>Nestr</code></td></tr>
                  <tr><td><strong>Remote MCP URL</strong></td><td><code>https://mcp.nestr.io/mcp</code></td></tr>
                  <tr><td><strong>Headers</strong></td><td><code>X-Nestr-API-Key: your-api-key-here</code></td></tr>
                </table>
              </div>

              <div class="config-block local oauth">
                <p>For local setup, edit your config file:</p>
                <ul>
                  <li><strong>macOS:</strong> <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></li>
                  <li><strong>Windows:</strong> <code>%APPDATA%\Claude\claude_desktop_config.json</code></li>
                </ul>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "command": "npx",
      "args": ["-y", "@nestr/mcp"],
      "env": {
        "NESTR_OAUTH_TOKEN": "your-oauth-token-here"
      }
    }
  }
}</code></pre>
                <p>Restart Claude Desktop after saving.</p>
              </div>

              <div class="config-block local apikey">
                <p>For local setup, edit your config file:</p>
                <ul>
                  <li><strong>macOS:</strong> <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></li>
                  <li><strong>Windows:</strong> <code>%APPDATA%\Claude\claude_desktop_config.json</code></li>
                </ul>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "command": "npx",
      "args": ["-y", "@nestr/mcp"],
      "env": {
        "NESTR_API_KEY": "your-api-key-here"
      }
    }
  }
}</code></pre>
                <p>Restart Claude Desktop after saving.</p>
              </div>
            </div>

            <div class="tab-content" id="claude-code">
              <div class="config-block hosted oauth active">
                <div class="quickstart-box">
                  <h4>Quickstart (Recommended)</h4>
                  <p><strong>Step 1:</strong> Add the Nestr MCP server:</p>
                  <pre><code>claude mcp add nestr --transport http https://mcp.nestr.io/mcp</code></pre>
                  <p><strong>Step 2:</strong> In Claude Code, run <code>/mcp</code> and click "Authenticate" next to Nestr. This will open your browser to log in with Nestr.</p>
                  <p class="quickstart-note">That's it! Once authenticated, Claude Code can access your Nestr workspace.</p>
                </div>
                <p>Or, if you already have a token, add it manually:</p>
                <pre><code>claude mcp add nestr --transport http https://mcp.nestr.io/mcp \
  --header "Authorization: Bearer your-oauth-token-here"</code></pre>
              </div>

              <div class="config-block hosted apikey">
                <p>Run this command in your terminal:</p>
                <pre><code>claude mcp add nestr --transport http https://mcp.nestr.io/mcp \
  --header "X-Nestr-API-Key: your-api-key-here"</code></pre>
              </div>

              <div class="config-block local oauth">
                <p>Run this command in your terminal:</p>
                <pre><code>claude mcp add nestr -- npx -y @nestr/mcp \
  --env NESTR_OAUTH_TOKEN=your-oauth-token-here</code></pre>
              </div>

              <div class="config-block local apikey">
                <p>Run this command in your terminal:</p>
                <pre><code>claude mcp add nestr -- npx -y @nestr/mcp \
  --env NESTR_API_KEY=your-api-key-here</code></pre>
              </div>

              <p>Run <code>/mcp</code> anytime to check connection status or re-authenticate.</p>
            </div>

            <div class="tab-content" id="cursor">
              <p>In Cursor, go to <strong>Settings &rarr; Cursor Settings &rarr; MCP Servers</strong>, or edit the config file:</p>
              <ul>
                <li><strong>macOS/Linux:</strong> <code>~/.cursor/mcp.json</code></li>
                <li><strong>Windows:</strong> <code>%USERPROFILE%\.cursor\mcp.json</code></li>
              </ul>

              <div class="config-block hosted oauth active">
                <div class="token-section" id="cursor-hosted-oauth-token">
                  <a href="/oauth/authorize" class="btn primary token-btn" onclick="saveStateBeforeOAuth('cursor')">Get Your Token</a>
                  <span class="token-hint">Login with Nestr to get your OAuth token</span>
                </div>
                <div class="token-success" id="cursor-hosted-oauth-success" style="display: none;">
                  <div class="token-success-header">Authentication Successful</div>
                  <p>Copy this token into the configuration below:</p>
                  <div class="token-display">
                    <input type="text" class="token-value" readonly>
                    <button class="btn primary" onclick="copyToken(this)">Copy</button>
                  </div>
                  <p class="copy-feedback" style="display: none;">Copied to clipboard!</p>
                </div>
                <p>Add the following configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "url": "https://mcp.nestr.io/mcp",
      "headers": {
        "Authorization": "Bearer <span class="token-placeholder">your-oauth-token-here</span>"
      }
    }
  }
}</code></pre>
              </div>

              <div class="config-block hosted apikey">
                <p>Add the following configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "url": "https://mcp.nestr.io/mcp",
      "headers": {
        "X-Nestr-API-Key": "your-api-key-here"
      }
    }
  }
}</code></pre>
              </div>

              <div class="config-block local oauth">
                <div class="token-section" id="cursor-local-oauth-token">
                  <a href="/oauth/authorize" class="btn primary token-btn" onclick="saveStateBeforeOAuth('cursor')">Get Your Token</a>
                  <span class="token-hint">Login with Nestr to get your OAuth token</span>
                </div>
                <div class="token-success" id="cursor-local-oauth-success" style="display: none;">
                  <div class="token-success-header">Authentication Successful</div>
                  <p>Copy this token into the configuration below:</p>
                  <div class="token-display">
                    <input type="text" class="token-value" readonly>
                    <button class="btn primary" onclick="copyToken(this)">Copy</button>
                  </div>
                  <p class="copy-feedback" style="display: none;">Copied to clipboard!</p>
                </div>
                <p>Add the following configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "command": "npx",
      "args": ["-y", "@nestr/mcp"],
      "env": {
        "NESTR_OAUTH_TOKEN": "<span class="token-placeholder">your-oauth-token-here</span>"
      }
    }
  }
}</code></pre>
              </div>

              <div class="config-block local apikey">
                <p>Add the following configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "command": "npx",
      "args": ["-y", "@nestr/mcp"],
      "env": {
        "NESTR_API_KEY": "your-api-key-here"
      }
    }
  }
}</code></pre>
              </div>
              <p>Restart Cursor after saving.</p>
            </div>

            <div class="tab-content" id="manual">
              <p>For other MCP clients, use these configuration details:</p>

              <div class="config-block hosted oauth active">
                <div class="token-section" id="manual-hosted-oauth-token">
                  <a href="/oauth/authorize" class="btn primary token-btn" onclick="saveStateBeforeOAuth('manual')">Get Your Token</a>
                  <span class="token-hint">Login with Nestr to get your OAuth token</span>
                </div>
                <div class="token-success" id="manual-hosted-oauth-success" style="display: none;">
                  <div class="token-success-header">Authentication Successful</div>
                  <p>Copy this token into the configuration below:</p>
                  <div class="token-display">
                    <input type="text" class="token-value" readonly>
                    <button class="btn primary" onclick="copyToken(this)">Copy</button>
                  </div>
                  <p class="copy-feedback" style="display: none;">Copied to clipboard!</p>
                </div>
                <table class="field-table">
                  <tr><td><strong>MCP Server URL</strong></td><td><code>https://mcp.nestr.io/mcp</code></td></tr>
                  <tr><td><strong>Transport</strong></td><td>HTTP (Streamable)</td></tr>
                  <tr><td><strong>Authorization Header</strong></td><td><code>Bearer <span class="token-placeholder">your-oauth-token-here</span></code></td></tr>
                </table>
                <p>Or as JSON configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "url": "https://mcp.nestr.io/mcp",
      "headers": {
        "Authorization": "Bearer <span class="token-placeholder">your-oauth-token-here</span>"
      }
    }
  }
}</code></pre>
              </div>

              <div class="config-block hosted apikey">
                <table class="field-table">
                  <tr><td><strong>MCP Server URL</strong></td><td><code>https://mcp.nestr.io/mcp</code></td></tr>
                  <tr><td><strong>Transport</strong></td><td>HTTP (Streamable)</td></tr>
                  <tr><td><strong>Header</strong></td><td><code>X-Nestr-API-Key: your-api-key-here</code></td></tr>
                </table>
                <p>Or as JSON configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "url": "https://mcp.nestr.io/mcp",
      "headers": {
        "X-Nestr-API-Key": "your-api-key-here"
      }
    }
  }
}</code></pre>
              </div>

              <div class="config-block local oauth">
                <div class="token-section" id="manual-local-oauth-token">
                  <a href="/oauth/authorize" class="btn primary token-btn" onclick="saveStateBeforeOAuth('manual')">Get Your Token</a>
                  <span class="token-hint">Login with Nestr to get your OAuth token</span>
                </div>
                <div class="token-success" id="manual-local-oauth-success" style="display: none;">
                  <div class="token-success-header">Authentication Successful</div>
                  <p>Copy this token into the configuration below:</p>
                  <div class="token-display">
                    <input type="text" class="token-value" readonly>
                    <button class="btn primary" onclick="copyToken(this)">Copy</button>
                  </div>
                  <p class="copy-feedback" style="display: none;">Copied to clipboard!</p>
                </div>
                <table class="field-table">
                  <tr><td><strong>Command</strong></td><td><code>npx -y @nestr/mcp</code></td></tr>
                  <tr><td><strong>Transport</strong></td><td>stdio</td></tr>
                  <tr><td><strong>Environment</strong></td><td><code>NESTR_OAUTH_TOKEN=<span class="token-placeholder">your-oauth-token-here</span></code></td></tr>
                </table>
                <p>Or as JSON configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "command": "npx",
      "args": ["-y", "@nestr/mcp"],
      "env": {
        "NESTR_OAUTH_TOKEN": "<span class="token-placeholder">your-oauth-token-here</span>"
      }
    }
  }
}</code></pre>
              </div>

              <div class="config-block local apikey">
                <table class="field-table">
                  <tr><td><strong>Command</strong></td><td><code>npx -y @nestr/mcp</code></td></tr>
                  <tr><td><strong>Transport</strong></td><td>stdio</td></tr>
                  <tr><td><strong>Environment</strong></td><td><code>NESTR_API_KEY=your-api-key-here</code></td></tr>
                </table>
                <p>Or as JSON configuration:</p>
                <pre><code>{
  "mcpServers": {
    "nestr": {
      "command": "npx",
      "args": ["-y", "@nestr/mcp"],
      "env": {
        "NESTR_API_KEY": "your-api-key-here"
      }
    }
  }
}</code></pre>
              </div>
            </div>

          </div>
        </div>

        <div class="step">
          <div class="step-number">4</div>
          <div class="step-content">
            <h3>Start Using It</h3>
            <p>Once configured, the Nestr tools are automatically available to your AI assistant. No special syntax or @ mentions needed &mdash; just ask naturally:</p>
            <ul class="example-queries">
              <li>"What workspaces do I have access to?"</li>
              <li>"Search for tasks related to marketing"</li>
              <li>"Create a new project called 'Q1 Planning' in the Strategy circle"</li>
              <li>"What are my current projects and their status?"</li>
              <li>"Who is responsible for customer support?"</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section id="examples" class="examples">
      <div class="container">
        <h2>Example Conversations</h2>

        <div class="example">
          <div class="user-message">
            <strong>You:</strong> What's the status of our Marketing projects?
          </div>
          <div class="ai-message">
            <strong>Claude:</strong> I'll check your Marketing circle projects.
            <br><br>
            Found 4 projects in Marketing:
            <ul>
              <li><strong>Website Redesign</strong> - Status: Current, Due: Jan 30</li>
              <li><strong>Q1 Campaign</strong> - Status: Current, Due: Feb 15</li>
              <li><strong>Brand Guidelines Update</strong> - Status: Waiting (blocked on design review)</li>
              <li><strong>Social Media Strategy</strong> - Status: Future</li>
            </ul>
          </div>
        </div>

        <div class="example">
          <div class="user-message">
            <strong>You:</strong> Create a task to "Review analytics dashboard" under the Product Owner role
          </div>
          <div class="ai-message">
            <strong>Claude:</strong> I've created the task "Review analytics dashboard" under the Product Owner role.
            <br><br>
            <strong>Details:</strong>
            <ul>
              <li>ID: abc123</li>
              <li>Parent: Product Owner</li>
              <li>Status: Current (default)</li>
            </ul>
            Would you like me to add a due date or any additional details?
          </div>
        </div>

        <div class="example">
          <div class="user-message">
            <strong>You:</strong> Who should I talk to about the API integration?
          </div>
          <div class="ai-message">
            <strong>Claude:</strong> Based on your workspace structure, the <strong>Developer</strong> role in the <strong>Tech</strong> circle is responsible for API integrations.
            <br><br>
            <strong>Currently assigned to:</strong> Jane Smith
            <br>
            <strong>Accountabilities include:</strong>
            <ul>
              <li>Building and maintaining API integrations</li>
              <li>Documenting technical implementations</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section class="tools">
      <div class="container">
        <h2>Available Tools</h2>
        <div class="tool-grid">
          <div class="tool">
            <code>nestr_list_workspaces</code>
            <p>List accessible workspaces</p>
          </div>
          <div class="tool">
            <code>nestr_search</code>
            <p>Search for tasks, projects, roles</p>
          </div>
          <div class="tool">
            <code>nestr_create_nest</code>
            <p>Create new tasks or projects</p>
          </div>
          <div class="tool">
            <code>nestr_update_nest</code>
            <p>Update nest properties</p>
          </div>
          <div class="tool">
            <code>nestr_list_circles</code>
            <p>List organizational circles</p>
          </div>
          <div class="tool">
            <code>nestr_get_circle_roles</code>
            <p>Get roles in a circle</p>
          </div>
          <div class="tool">
            <code>nestr_get_insights</code>
            <p>Get workspace metrics</p>
          </div>
          <div class="tool">
            <code>nestr_add_comment</code>
            <p>Add comments to nests</p>
          </div>
        </div>
        <p class="tool-note">
          <a href="https://github.com/nestr-dev/nestr-mcp#available-tools" target="_blank">
            View full tool documentation &rarr;
          </a>
        </p>
      </div>
    </section>

    <section class="support">
      <div class="container">
        <h2>Need Help?</h2>
        <div class="support-links">
          <a href="https://help.nestr.io" target="_blank" class="support-link">
            <div class="support-icon">&#128218;</div>
            <div>
              <strong>Documentation</strong>
              <p>Learn more about Nestr</p>
            </div>
          </a>
          <a href="https://github.com/nestr-dev/nestr-mcp/issues" target="_blank" class="support-link">
            <div class="support-icon">&#128030;</div>
            <div>
              <strong>Report Issues</strong>
              <p>Found a bug? Let us know</p>
            </div>
          </a>
          <a href="https://modelcontextprotocol.io" target="_blank" class="support-link">
            <div class="support-icon">&#128279;</div>
            <div>
              <strong>MCP Specification</strong>
              <p>Learn about the protocol</p>
            </div>
          </a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2026 Nestr. Built with the <a href="https://modelcontextprotocol.io" target="_blank">Model Context Protocol</a>.</p>
    </div>
  </footer>

  <script>
    // Track current selections
    let currentAuth = 'oauth';
    let currentSetup = 'hosted';

    // Function to update config blocks based on current selections
    function updateConfigBlocks() {
      document.querySelectorAll('.config-block').forEach(block => {
        block.classList.remove('active');
        if (block.classList.contains(currentSetup) && block.classList.contains(currentAuth)) {
          block.classList.add('active');
        }
      });
    }

    // Tab switching (Claude Desktop / Claude Code / Cursor)
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;

        // Update active tab
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        // Update active content
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
      });
    });

    // Auth method selection (oauth vs apikey)
    document.querySelectorAll('.auth-option').forEach(option => {
      option.addEventListener('click', () => {
        currentAuth = option.dataset.auth;

        // Update active option
        document.querySelectorAll('.auth-option').forEach(o => o.classList.remove('active'));
        option.classList.add('active');

        // Update auth details section
        document.querySelectorAll('.auth-detail').forEach(d => d.classList.remove('active'));
        document.getElementById('auth-detail-' + currentAuth).classList.add('active');

        // Update config blocks
        updateConfigBlocks();
      });
    });

    // Setup method selection (hosted vs local)
    document.querySelectorAll('.setup-option').forEach(option => {
      option.addEventListener('click', () => {
        currentSetup = option.dataset.method;

        // Update active option
        document.querySelectorAll('.setup-option').forEach(o => o.classList.remove('active'));
        option.classList.add('active');

        // Update config blocks
        updateConfigBlocks();
      });
    });

    // Save state before OAuth redirect
    function saveStateBeforeOAuth(tab) {
      localStorage.setItem('nestr-mcp-oauth-state', JSON.stringify({
        auth: currentAuth,
        setup: currentSetup,
        tab: tab
      }));
    }

    // Restore state from localStorage
    function restoreState() {
      const saved = localStorage.getItem('nestr-mcp-oauth-state');
      if (!saved) return null;

      try {
        const state = JSON.parse(saved);

        // Restore auth selection
        if (state.auth) {
          currentAuth = state.auth;
          document.querySelectorAll('.auth-option').forEach(o => {
            o.classList.toggle('active', o.dataset.auth === state.auth);
          });
          document.querySelectorAll('.auth-detail').forEach(d => d.classList.remove('active'));
          const authDetail = document.getElementById('auth-detail-' + state.auth);
          if (authDetail) authDetail.classList.add('active');
        }

        // Restore setup selection
        if (state.setup) {
          currentSetup = state.setup;
          document.querySelectorAll('.setup-option').forEach(o => {
            o.classList.toggle('active', o.dataset.method === state.setup);
          });
        }

        // Restore tab selection
        if (state.tab) {
          document.querySelectorAll('.tab').forEach(t => {
            t.classList.toggle('active', t.dataset.tab === state.tab);
          });
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          const tabContent = document.getElementById(state.tab);
          if (tabContent) tabContent.classList.add('active');
        }

        // Update config blocks
        updateConfigBlocks();

        return state;
      } catch (e) {
        return null;
      }
    }

    // Show token inline in the current tab
    function showTokenInline(token, tab, setup) {
      // Build the ID for the token section to hide and success section to show
      const tokenSectionId = `${tab}-${setup}-oauth-token`;
      const successSectionId = `${tab}-${setup}-oauth-success`;

      const tokenSection = document.getElementById(tokenSectionId);
      const successSection = document.getElementById(successSectionId);

      if (tokenSection) tokenSection.style.display = 'none';
      if (successSection) {
        successSection.style.display = 'block';
        const input = successSection.querySelector('.token-value');
        if (input) input.value = token;
      }

      // Also update all token placeholders in the active config block
      document.querySelectorAll('.config-block.active .token-placeholder').forEach(el => {
        el.textContent = token;
        el.classList.add('token-filled');
      });

      // Scroll to setup section
      document.getElementById('setup')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Copy token from inline display
    function copyToken(button) {
      const container = button.closest('.token-success');
      const input = container.querySelector('.token-value');
      input.select();
      input.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(input.value).then(() => {
        const feedback = container.querySelector('.copy-feedback');
        feedback.style.display = 'block';
        setTimeout(() => {
          feedback.style.display = 'none';
        }, 2000);
      });
    }

    // Check for token in URL hash on page load
    (function checkForToken() {
      const hash = window.location.hash;
      if (hash.startsWith('#token=')) {
        const token = decodeURIComponent(hash.substring(7));
        if (token) {
          // Restore previous state
          const state = restoreState();

          // Clear saved state
          localStorage.removeItem('nestr-mcp-oauth-state');

          // Clear hash from URL
          history.replaceState(null, '', window.location.pathname);

          // Show token inline (default to manual/hosted if no state)
          const tab = state?.tab || 'manual';
          const setup = state?.setup || 'hosted';

          // Small delay to ensure DOM is updated
          setTimeout(() => {
            showTokenInline(token, tab, setup);
          }, 100);
        }
      }
    })();

  </script>
</body>
</html>
